!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.musicolors=e():t.musicolors=e()}(this,(()=>(()=>{var t={645:t=>{"use strict";function e(t){if(this.size=0|t,this.size<=1||0!=(this.size&this.size-1))throw new Error("FFT size must be a power of two and bigger than 1");this._csize=t<<1;for(var e=new Array(2*this.size),r=0;r<e.length;r+=2){const t=Math.PI*r/this.size;e[r]=Math.cos(t),e[r+1]=-Math.sin(t)}this.table=e;for(var n=0,a=1;this.size>a;a<<=1)n++;this._width=n%2==0?n-1:n,this._bitrev=new Array(1<<this._width);for(var i=0;i<this._bitrev.length;i++){this._bitrev[i]=0;for(var o=0;o<this._width;o+=2){var s=this._width-o-2;this._bitrev[i]|=(i>>>o&3)<<s}}this._out=null,this._data=null,this._inv=0}t.exports=e,e.prototype.fromComplexArray=function(t,e){for(var r=e||new Array(t.length>>>1),n=0;n<t.length;n+=2)r[n>>>1]=t[n];return r},e.prototype.createComplexArray=function(){const t=new Array(this._csize);for(var e=0;e<t.length;e++)t[e]=0;return t},e.prototype.toComplexArray=function(t,e){for(var r=e||this.createComplexArray(),n=0;n<r.length;n+=2)r[n]=t[n>>>1],r[n+1]=0;return r},e.prototype.completeSpectrum=function(t){for(var e=this._csize,r=e>>>1,n=2;n<r;n+=2)t[e-n]=t[n],t[e-n+1]=-t[n+1]},e.prototype.transform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._transform4(),this._out=null,this._data=null},e.prototype.realTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._realTransform4(),this._out=null,this._data=null},e.prototype.inverseTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=1,this._transform4();for(var r=0;r<t.length;r++)t[r]/=this.size;this._out=null,this._data=null},e.prototype._transform4=function(){var t,e,r=this._out,n=this._csize,a=1<<this._width,i=n/a<<1,o=this._bitrev;if(4===i)for(t=0,e=0;t<n;t+=i,e++){const r=o[e];this._singleTransform2(t,r,a)}else for(t=0,e=0;t<n;t+=i,e++){const r=o[e];this._singleTransform4(t,r,a)}var s=this._inv?-1:1,h=this.table;for(a>>=2;a>=2;a>>=2){var u=(i=n/a<<1)>>>2;for(t=0;t<n;t+=i)for(var l=t+u,c=t,f=0;c<l;c+=2,f+=a){const t=c,e=t+u,n=e+u,a=n+u,i=r[t],o=r[t+1],l=r[e],m=r[e+1],p=r[n],d=r[n+1],_=r[a],g=r[a+1],y=i,w=o,v=h[f],b=s*h[f+1],S=l*v-m*b,x=l*b+m*v,M=h[2*f],A=s*h[2*f+1],F=p*M-d*A,C=p*A+d*M,D=h[3*f],T=s*h[3*f+1],E=_*D-g*T,z=_*T+g*D,B=y+F,I=w+C,O=y-F,k=w-C,R=S+E,q=x+z,P=s*(S-E),N=s*(x-z),j=B+R,V=I+q,$=B-R,L=I-q,U=O+N,X=k-P,H=O-N,Y=k+P;r[t]=j,r[t+1]=V,r[e]=U,r[e+1]=X,r[n]=$,r[n+1]=L,r[a]=H,r[a+1]=Y}}},e.prototype._singleTransform2=function(t,e,r){const n=this._out,a=this._data,i=a[e],o=a[e+1],s=a[e+r],h=a[e+r+1],u=i+s,l=o+h,c=i-s,f=o-h;n[t]=u,n[t+1]=l,n[t+2]=c,n[t+3]=f},e.prototype._singleTransform4=function(t,e,r){const n=this._out,a=this._data,i=this._inv?-1:1,o=2*r,s=3*r,h=a[e],u=a[e+1],l=a[e+r],c=a[e+r+1],f=a[e+o],m=a[e+o+1],p=a[e+s],d=a[e+s+1],_=h+f,g=u+m,y=h-f,w=u-m,v=l+p,b=c+d,S=i*(l-p),x=i*(c-d),M=_+v,A=g+b,F=y+x,C=w-S,D=_-v,T=g-b,E=y-x,z=w+S;n[t]=M,n[t+1]=A,n[t+2]=F,n[t+3]=C,n[t+4]=D,n[t+5]=T,n[t+6]=E,n[t+7]=z},e.prototype._realTransform4=function(){var t,e,r=this._out,n=this._csize,a=1<<this._width,i=n/a<<1,o=this._bitrev;if(4===i)for(t=0,e=0;t<n;t+=i,e++){const r=o[e];this._singleRealTransform2(t,r>>>1,a>>>1)}else for(t=0,e=0;t<n;t+=i,e++){const r=o[e];this._singleRealTransform4(t,r>>>1,a>>>1)}var s=this._inv?-1:1,h=this.table;for(a>>=2;a>=2;a>>=2){var u=(i=n/a<<1)>>>1,l=u>>>1,c=l>>>1;for(t=0;t<n;t+=i)for(var f=0,m=0;f<=c;f+=2,m+=a){var p=t+f,d=p+l,_=d+l,g=_+l,y=r[p],w=r[p+1],v=r[d],b=r[d+1],S=r[_],x=r[_+1],M=r[g],A=r[g+1],F=y,C=w,D=h[m],T=s*h[m+1],E=v*D-b*T,z=v*T+b*D,B=h[2*m],I=s*h[2*m+1],O=S*B-x*I,k=S*I+x*B,R=h[3*m],q=s*h[3*m+1],P=M*R-A*q,N=M*q+A*R,j=F+O,V=C+k,$=F-O,L=C-k,U=E+P,X=z+N,H=s*(E-P),Y=s*(z-N),G=j+U,K=V+X,J=$+Y,W=L-H;if(r[p]=G,r[p+1]=K,r[d]=J,r[d+1]=W,0!==f){if(f!==c){var Q=$+-s*Y,Z=-s*H-L,tt=j+-s*U,et=-V- -s*X,rt=t+l-f,nt=t+u-f;r[rt]=Q,r[rt+1]=Z,r[nt]=tt,r[nt+1]=et}}else{var at=j-U,it=V-X;r[_]=at,r[_+1]=it}}}},e.prototype._singleRealTransform2=function(t,e,r){const n=this._out,a=this._data,i=a[e],o=a[e+r],s=i+o,h=i-o;n[t]=s,n[t+1]=0,n[t+2]=h,n[t+3]=0},e.prototype._singleRealTransform4=function(t,e,r){const n=this._out,a=this._data,i=this._inv?-1:1,o=2*r,s=3*r,h=a[e],u=a[e+r],l=a[e+o],c=a[e+s],f=h+l,m=h-l,p=u+c,d=i*(u-c),_=f+p,g=m,y=-d,w=f-p,v=m,b=d;n[t]=_,n[t+1]=0,n[t+2]=g,n[t+3]=y,n[t+4]=w,n[t+5]=0,n[t+6]=v,n[t+7]=b}},752:function(t){t.exports=function(){"use strict";function t(t,e,r){if(r||2===arguments.length)for(var n,a=0,i=e.length;a<i;a++)!n&&a in e||(n||(n=Array.prototype.slice.call(e,0,a)),n[a]=e[a]);return t.concat(n||Array.prototype.slice.call(e))}var e=Object.freeze({__proto__:null,blackman:function(t){for(var e=new Float32Array(t),r=2*Math.PI/(t-1),n=2*r,a=0;a<t/2;a++)e[a]=.42-.5*Math.cos(a*r)+.08*Math.cos(a*n);for(a=Math.ceil(t/2);a>0;a--)e[t-a]=e[a-1];return e},sine:function(t){for(var e=Math.PI/(t-1),r=new Float32Array(t),n=0;n<t;n++)r[n]=Math.sin(e*n);return r},hanning:function(t){for(var e=new Float32Array(t),r=0;r<t;r++)e[r]=.5-.5*Math.cos(2*Math.PI*r/(t-1));return e},hamming:function(t){for(var e=new Float32Array(t),r=0;r<t;r++)e[r]=.54-.46*Math.cos(2*Math.PI*(r/t-1));return e}}),r={};function n(t){for(;t%2==0&&t>1;)t/=2;return 1===t}function a(t,n){if("rect"!==n){if(""!==n&&n||(n="hanning"),r[n]||(r[n]={}),!r[n][t.length])try{r[n][t.length]=e[n](t.length)}catch(t){throw new Error("Invalid windowing function")}t=function(t,e){for(var r=[],n=0;n<Math.min(t.length,e.length);n++)r[n]=t[n]*e[n];return r}(t,r[n][t.length])}return t}function i(t,e,r){for(var n=new Float32Array(t),a=0;a<n.length;a++)n[a]=a*e/r,n[a]=13*Math.atan(n[a]/1315.8)+3.5*Math.atan(Math.pow(n[a]/7518,2));return n}function o(t){return Float32Array.from(t)}function s(t){return 1125*Math.log(1+t/700)}function h(t,e,r){for(var n,a=new Float32Array(t+2),i=new Float32Array(t+2),o=e/2,h=s(0),u=(s(o)-h)/(t+1),l=new Array(t+2),c=0;c<a.length;c++)a[c]=c*u,i[c]=(n=a[c],700*(Math.exp(n/1125)-1)),l[c]=Math.floor((r+1)*i[c]/e);for(var f=new Array(t),m=0;m<f.length;m++){for(f[m]=new Array(r/2+1).fill(0),c=l[m];c<l[m+1];c++)f[m][c]=(c-l[m])/(l[m+1]-l[m]);for(c=l[m+1];c<l[m+2];c++)f[m][c]=(l[m+2]-c)/(l[m+2]-l[m+1])}return f}function u(e,r,n,a,i,o,s){void 0===a&&(a=5),void 0===i&&(i=2),void 0===o&&(o=!0),void 0===s&&(s=440);var h=Math.floor(n/2)+1,u=new Array(n).fill(0).map((function(t,a){return e*function(t,e){return Math.log2(16*t/e)}(r*a/n,s)}));u[0]=u[1]-1.5*e;var l,c,f,m=u.slice(1).map((function(t,e){return Math.max(t-u[e])}),1).concat([1]),p=Math.round(e/2),d=new Array(e).fill(0).map((function(t,r){return u.map((function(t){return(10*e+p+t-r)%e-p}))})),_=d.map((function(t,e){return t.map((function(t,r){return Math.exp(-.5*Math.pow(2*d[e][r]/m[r],2))}))}));if(c=(l=_)[0].map((function(){return 0})),f=l.reduce((function(t,e){return e.forEach((function(e,r){t[r]+=Math.pow(e,2)})),t}),c).map(Math.sqrt),_=l.map((function(t,e){return t.map((function(t,e){return t/(f[e]||1)}))})),i){var g=u.map((function(t){return Math.exp(-.5*Math.pow((t/e-a)/i,2))}));_=_.map((function(t){return t.map((function(t,e){return t*g[e]}))}))}return o&&(_=t(t([],_.slice(3),!0),_.slice(0,3),!0)),_.map((function(t){return t.slice(0,h)}))}function l(t,e){for(var r=0,n=0,a=0;a<e.length;a++)r+=Math.pow(a,t)*Math.abs(e[a]),n+=e[a];return r/n}function c(t){var e=t.ampSpectrum,r=t.barkScale,n=t.numberOfBarkBands,a=void 0===n?24:n;if("object"!=typeof e||"object"!=typeof r)throw new TypeError;var i=a,o=new Float32Array(i),s=0,h=e,u=new Int32Array(i+1);u[0]=0;for(var l=r[h.length-1]/i,c=1,f=0;f<h.length;f++)for(;r[f]>l;)u[c++]=f,l=c*r[h.length-1]/i;for(u[i]=h.length-1,f=0;f<i;f++){for(var m=0,p=u[f];p<u[f+1];p++)m+=h[p];o[f]=Math.pow(m,.23)}for(f=0;f<o.length;f++)s+=o[f];return{specific:o,total:s}}function f(t){var e=t.ampSpectrum;if("object"!=typeof e)throw new TypeError;for(var r=new Float32Array(e.length),n=0;n<r.length;n++)r[n]=Math.pow(e[n],2);return r}function m(t){var e=t.ampSpectrum,r=t.melFilterBank,n=t.bufferSize;if("object"!=typeof e)throw new TypeError("Valid ampSpectrum is required to generate melBands");if("object"!=typeof r)throw new TypeError("Valid melFilterBank is required to generate melBands");for(var a=f({ampSpectrum:e}),i=r.length,o=Array(i),s=new Float32Array(i),h=0;h<s.length;h++){o[h]=new Float32Array(n/2),s[h]=0;for(var u=0;u<n/2;u++)o[h][u]=r[h][u]*a[u],s[h]+=o[h][u];s[h]=Math.log(s[h]+1)}return Array.prototype.slice.call(s)}var p={exports:{}},d=null,_=function(t,e){var r=t.length;return e=e||2,d&&d[r]||function(t){(d=d||{})[t]=new Array(t*t);for(var e=Math.PI/t,r=0;r<t;r++)for(var n=0;n<t;n++)d[t][n+r*t]=Math.cos(e*(n+.5)*r)}(r),t.map((function(){return 0})).map((function(n,a){return e*t.reduce((function(t,e,n,i){return t+e*d[r][n+a*r]}),0)}))};!function(t){t.exports=_}(p);var g=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(p.exports),y=Object.freeze({__proto__:null,buffer:function(t){return t.signal},rms:function(t){var e=t.signal;if("object"!=typeof e)throw new TypeError;for(var r=0,n=0;n<e.length;n++)r+=Math.pow(e[n],2);return r/=e.length,Math.sqrt(r)},energy:function(t){var e=t.signal;if("object"!=typeof e)throw new TypeError;for(var r=0,n=0;n<e.length;n++)r+=Math.pow(Math.abs(e[n]),2);return r},complexSpectrum:function(t){return t.complexSpectrum},spectralSlope:function(t){var e=t.ampSpectrum,r=t.sampleRate,n=t.bufferSize;if("object"!=typeof e)throw new TypeError;for(var a=0,i=0,o=new Float32Array(e.length),s=0,h=0,u=0;u<e.length;u++){a+=e[u];var l=u*r/n;o[u]=l,s+=l*l,i+=l,h+=l*e[u]}return(e.length*h-i*a)/(a*(s-Math.pow(i,2)))},spectralCentroid:function(t){var e=t.ampSpectrum;if("object"!=typeof e)throw new TypeError;return l(1,e)},spectralRolloff:function(t){var e=t.ampSpectrum,r=t.sampleRate;if("object"!=typeof e)throw new TypeError;for(var n=e,a=r/(2*(n.length-1)),i=0,o=0;o<n.length;o++)i+=n[o];for(var s=.99*i,h=n.length-1;i>s&&h>=0;)i-=n[h],--h;return(h+1)*a},spectralFlatness:function(t){var e=t.ampSpectrum;if("object"!=typeof e)throw new TypeError;for(var r=0,n=0,a=0;a<e.length;a++)r+=Math.log(e[a]),n+=e[a];return Math.exp(r/e.length)*e.length/n},spectralSpread:function(t){var e=t.ampSpectrum;if("object"!=typeof e)throw new TypeError;return Math.sqrt(l(2,e)-Math.pow(l(1,e),2))},spectralSkewness:function(t){var e=t.ampSpectrum;if("object"!=typeof e)throw new TypeError;var r=l(1,e),n=l(2,e),a=l(3,e);return(2*Math.pow(r,3)-3*r*n+a)/Math.pow(Math.sqrt(n-Math.pow(r,2)),3)},spectralKurtosis:function(t){var e=t.ampSpectrum;if("object"!=typeof e)throw new TypeError;var r=e,n=l(1,r),a=l(2,r),i=l(3,r),o=l(4,r);return(-3*Math.pow(n,4)+6*n*a-4*n*i+o)/Math.pow(Math.sqrt(a-Math.pow(n,2)),4)},amplitudeSpectrum:function(t){return t.ampSpectrum},zcr:function(t){var e=t.signal;if("object"!=typeof e)throw new TypeError;for(var r=0,n=1;n<e.length;n++)(e[n-1]>=0&&e[n]<0||e[n-1]<0&&e[n]>=0)&&r++;return r},loudness:c,perceptualSpread:function(t){for(var e=c({ampSpectrum:t.ampSpectrum,barkScale:t.barkScale}),r=0,n=0;n<e.specific.length;n++)e.specific[n]>r&&(r=e.specific[n]);return Math.pow((e.total-r)/e.total,2)},perceptualSharpness:function(t){for(var e=c({ampSpectrum:t.ampSpectrum,barkScale:t.barkScale}),r=e.specific,n=0,a=0;a<r.length;a++)n+=a<15?(a+1)*r[a+1]:.066*Math.exp(.171*(a+1));return n*(.11/e.total)},powerSpectrum:f,mfcc:function(t){var e=t.ampSpectrum,r=t.melFilterBank,n=t.numberOfMFCCCoefficients,a=t.bufferSize,i=Math.min(40,Math.max(1,n||13));if(r.length<i)throw new Error("Insufficient filter bank for requested number of coefficients");var o=m({ampSpectrum:e,melFilterBank:r,bufferSize:a});return g(o).slice(0,i)},chroma:function(t){var e=t.ampSpectrum,r=t.chromaFilterBank;if("object"!=typeof e)throw new TypeError("Valid ampSpectrum is required to generate chroma");if("object"!=typeof r)throw new TypeError("Valid chromaFilterBank is required to generate chroma");var n=r.map((function(t,r){return e.reduce((function(e,r,n){return e+r*t[n]}),0)})),a=Math.max.apply(Math,n);return a?n.map((function(t){return t/a})):n},spectralFlux:function(t){var e=t.signal,r=t.previousSignal,n=t.bufferSize;if("object"!=typeof e||"object"!=typeof r)throw new TypeError;for(var a=0,i=-n/2;i<e.length/2-1;i++)x=Math.abs(e[i])-Math.abs(r[i]),a+=(x+Math.abs(x))/2;return a},spectralCrest:function(t){var e=t.ampSpectrum;if("object"!=typeof e)throw new TypeError;var r=0,n=-1/0;return e.forEach((function(t){r+=Math.pow(t,2),n=t>n?t:n})),r/=e.length,r=Math.sqrt(r),n/r},melBands:m});function w(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}var v={},b={},S=function(t){if(void 0===v[t]){for(var e=(t-1).toString(2).length,r="0".repeat(e),n={},a=0;a<t;a++){var i=a.toString(2);i=r.substr(i.length)+i,i=[].concat(w(i)).reverse().join(""),n[a]=parseInt(i,2)}v[t]=n}return v[t]},M=function(t,e){return{real:t.real*e.real-t.imag*e.imag,imag:t.real*e.imag+t.imag*e.real}},A=function(t,e){return{real:t.real+e.real,imag:t.imag+e.imag}},F=function(t,e){return{real:t.real-e.real,imag:t.imag-e.imag}},C=function(t,e){var r=-2*Math.PI*t/e;return{real:Math.cos(r),imag:Math.sin(r)}},D=function(t){var e={};e.real=void 0===t.real?t.slice():t.real.slice();var r=e.real.length;return void 0===b[r]&&(b[r]=Array.apply(null,Array(r)).map(Number.prototype.valueOf,0)),e.imag=b[r].slice(),e},T=function(t){var e={};void 0===t.real||void 0===t.imag?e=D(t):(e.real=t.real.slice(),e.imag=t.imag.slice());var r=e.real.length,n=Math.log2(r);if(Math.round(n)!=n)throw new Error("Input size must be a power of 2.");if(e.real.length!=e.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var a=S(r),i={real:[],imag:[]},o=0;o<r;o++)i.real[a[o]]=e.real[o],i.imag[a[o]]=e.imag[o];for(var s=0;s<r;s++)e.real[s]=i.real[s],e.imag[s]=i.imag[s];for(var h=1;h<=n;h++)for(var u=Math.pow(2,h),l=0;l<u/2;l++)for(var c=C(l,u),f=0;f<r/u;f++){var m=u*f+l,p=u*f+l+u/2,d={real:e.real[m],imag:e.imag[m]},_={real:e.real[p],imag:e.imag[p]},g=M(c,_),y=F(d,g);e.real[p]=y.real,e.imag[p]=y.imag;var w=A(g,d);e.real[m]=w.real,e.imag[m]=w.imag}return e},E=function(){function t(t,e){var r=this;if(this._m=e,!t.audioContext)throw this._m.errors.noAC;if(t.bufferSize&&!n(t.bufferSize))throw this._m._errors.notPow2;if(!t.source)throw this._m._errors.noSource;this._m.audioContext=t.audioContext,this._m.bufferSize=t.bufferSize||this._m.bufferSize||256,this._m.hopSize=t.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=t.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=t.callback,this._m.windowingFunction=t.windowingFunction||"hanning",this._m.featureExtractors=y,this._m.EXTRACTION_STARTED=t.startImmediately||!1,this._m.channel="number"==typeof t.channel?t.channel:0,this._m.inputs=t.inputs||1,this._m.outputs=t.outputs||1,this._m.numberOfMFCCCoefficients=t.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=t.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=t.featureExtractors||[],this._m.barkScale=i(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=h(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(t.source),this._m.spn.onaudioprocess=function(t){var e;null!==r._m.inputData&&(r._m.previousInputData=r._m.inputData),r._m.inputData=t.inputBuffer.getChannelData(r._m.channel),r._m.previousInputData?((e=new Float32Array(r._m.previousInputData.length+r._m.inputData.length-r._m.hopSize)).set(r._m.previousInputData.slice(r._m.hopSize)),e.set(r._m.inputData,r._m.previousInputData.length-r._m.hopSize)):e=r._m.inputData,function(t,e,r){if(t.length<e)throw new Error("Buffer is too short for frame length");if(r<1)throw new Error("Hop length cannot be less that 1");if(e<1)throw new Error("Frame length cannot be less that 1");var n=1+Math.floor((t.length-e)/r);return new Array(n).fill(0).map((function(n,a){return t.slice(a*r,a*r+e)}))}(e,r._m.bufferSize,r._m.hopSize).forEach((function(t){r._m.frame=t;var e=r._m.extract(r._m._featuresToExtract,r._m.frame,r._m.previousFrame);"function"==typeof r._m.callback&&r._m.EXTRACTION_STARTED&&r._m.callback(e),r._m.previousFrame=r._m.frame}))}}return t.prototype.start=function(t){this._m._featuresToExtract=t||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},t.prototype.stop=function(){this._m.EXTRACTION_STARTED=!1},t.prototype.setSource=function(t){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=t,this._m.source.connect(this._m.spn)},t.prototype.setChannel=function(t){t<=this._m.inputs?this._m.channel=t:console.error("Channel ".concat(t," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(t," when instantiating the MeydaAnalyzer"))},t.prototype.get=function(t){return this._m.inputData?this._m.extract(t||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},t}(),z={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:y,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:a,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(t){return new E(t,Object.assign({},z))},listAvailableFeatureExtractors:function(){return Object.keys(this.featureExtractors)},extract:function(t,e,r){var a=this;if(!e)throw this._errors.invalidInput;if("object"!=typeof e)throw this._errors.invalidInput;if(!t)throw this._errors.featureUndef;if(!n(e.length))throw this._errors.notPow2;void 0!==this.barkScale&&this.barkScale.length==this.bufferSize||(this.barkScale=i(this.bufferSize,this.sampleRate,this.bufferSize)),void 0!==this.melFilterBank&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=h(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),void 0!==this.chromaFilterBank&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=u(this.chromaBands,this.sampleRate,this.bufferSize)),"buffer"in e&&void 0===e.buffer?this.signal=o(e):this.signal=e;var s=B(e,this.windowingFunction,this.bufferSize);if(this.signal=s.windowedSignal,this.complexSpectrum=s.complexSpectrum,this.ampSpectrum=s.ampSpectrum,r){var l=B(r,this.windowingFunction,this.bufferSize);this.previousSignal=l.windowedSignal,this.previousComplexSpectrum=l.complexSpectrum,this.previousAmpSpectrum=l.ampSpectrum}var c=function(t){return a.featureExtractors[t]({ampSpectrum:a.ampSpectrum,chromaFilterBank:a.chromaFilterBank,complexSpectrum:a.complexSpectrum,signal:a.signal,bufferSize:a.bufferSize,sampleRate:a.sampleRate,barkScale:a.barkScale,melFilterBank:a.melFilterBank,previousSignal:a.previousSignal,previousAmpSpectrum:a.previousAmpSpectrum,previousComplexSpectrum:a.previousComplexSpectrum,numberOfMFCCCoefficients:a.numberOfMFCCCoefficients,numberOfBarkBands:a.numberOfBarkBands})};if("object"==typeof t)return t.reduce((function(t,e){var r;return Object.assign({},t,((r={})[e]=c(e),r))}),{});if("string"==typeof t)return c(t);throw this._errors.invalidFeatureFmt}},B=function(t,e,r){var n={};void 0===t.buffer?n.signal=o(t):n.signal=t,n.windowedSignal=a(n.signal,e),n.complexSpectrum=T(n.windowedSignal),n.ampSpectrum=new Float32Array(r/2);for(var i=0;i<r/2;i++)n.ampSpectrum[i]=Math.sqrt(Math.pow(n.complexSpectrum.real[i],2)+Math.pow(n.complexSpectrum.imag[i],2));return n};return"undefined"!=typeof window&&(window.Meyda=z),z}()},815:(t,e,r)=>{const n=r(427),a=r(790);function i(t,e){return n.getSemitonesFromNote(t.name,t.octave,e.name,e.octave)}t.exports=class{constructor(t,e){this.note1=t,this.note2=e,this.semitones=function(t){let e=t%a.length;return 0===e&&(e=0),e}(i(t,e)),this.octaves=function(t){let e;return t<0?(e=-1*Math.floor(-1*t/a.length),0===e&&(e=0)):e=Math.floor(t/a.length),e}(i(t,e));let r=`${this.semitones} semitone${1===this.semitones?"":"s"}`,n=`${this.octaves} octave${1===this.octaves?"":"s"}`;0===i(t,e)?this.summary=`There is no difference between the notes, they are both ${t.name+t.octave}`:this.summary=`The note ${this.note1.name+this.note1.octave} is ${0===this.octaves?"":n}${0===this.semitones||0===this.octaves?"":" and "}${0===this.semitones?"":r} away from ${e.name+e.octave}`}}},517:t=>{let e=[{code:"ERR_SYNTAX_NOTE",err:"That note does not exist"},{code:"ERR_SYNTAX_TOO_MANY_CHARS",err:"Too many characters"},{code:"ERR_SYNTAX_PITCHED",err:"Invalid pitch modifier"},{code:"ERR_SYNTAX_OCTAVE",err:"The octave was not set properly"},{code:"ERR_SYNTAX_TOO_FEW_CHARS",err:"Too few characters"},{code:"ERR_NOTE_TOO_HIGH",err:"The note is too high"},{code:"ERR_NOTE_TOO_LOW",err:"The note is too low"},{code:"ERR_FREQUENCY_OUT_OF_RANGE",err:"The frequency is either too low or too high"}];t.exports=class{constructor(t,r,n){this.id=t,this.extra=r,this.input=n,this.code=e[t].code,this.err=e[t].err}}},943:(t,e,r)=>{const n=r(427),a=r(815),i=r(517);t.exports=class{constructor(t,e,r,a){if(this.name=t,this.octave=e,this.note,this.tuning={name:a.name,octave:a.octave,frequency:a.frequency},null===r)this.frequency=n.fromNote(this,this.tuning),this.centsOff=0;else{this.frequency=r;let o=t||null,s=e||null,h=n.getCentsOffFromNote(o,s,r,a);!1!==h?(this.centsOff=h.cents,this.name=h.note.name,this.octave=h.note.octave):this.err=new i(7,`The frequency "${r}" is out of range`,r)}null!==this.name&&null!==this.octave&&(this.note=this.name+this.octave)}transpose(t){n.transpose(this,t)}compare(t){return new a(this,t)}}},614:(t,e,r)=>{const n=r(431),a=r(943);let i={name:"A",octave:4,frequency:440};t.exports={setRoot:(t,e)=>function(t,e){let r=n.parseString(t);return!(void 0!==r.err||isNaN(e)||e<=0||(i.name=r.name,i.octave=r.octave,i.frequency=e,0))}(t,e),noteFromName:t=>function(t){let e=n.parseString(t);return new a(e.name,e.octave,null,i)}(t),noteFromFreq:t=>new a(null,null,t,i)}},427:(t,e,r)=>{const n=r(790);function a(t,e){return Math.log(e/t)/Math.log(2)*1200}function i(t,e,r,a){return n.indexOf(t)-n.indexOf(r)+(e-a)*n.length}function o(){return s(2*n.length)}function s(t){return Math.pow(2,1/t)}function h(t,e,r){return r.frequency*Math.pow(s(n.length),function(t,e,r){return i(t,e,r.name,r.octave)}(t,e,r))}t.exports.fromNote=function(t){return h(t.name,t.octave,t.tuning)},t.exports.transpose=function(t,e,r){let a=n.indexOf(t.name)+r,i=t.octave;for(;a<0;)a+=n.length,i--;for(;a>n.length-1;)a-=n.length,i++;if(i<0)return new Error(7,`This result in octave being "${e}"`,string);t.octave=i,t.name=n[a]},t.exports.getSemitonesFromNote=i,t.exports.getCentsOffFromNote=function(t,e,r,i){let s=t,u=e;if(null===s||null===u){for(let t=-3;t<40;t++){let e=h(n[0],t,i)/o(),l=h(n[n.length-1],t,i)*o();if(r>=e&&r<=l){u=t;for(let t=0;t<n.length;t++){let e=a(h(n[t],u,i),r);if(e<=50&&e>-50){s=n[t];break}}}}if(null===u)return!1;if(null===s)return!1}return{note:{name:s,octave:u},cents:a(h(s,u,i),r)}}},431:(t,e,r)=>{const n=r(790),a=r(337),i=r(517);t.exports.parseString=function(t){let e=t.split(""),r=null,o=null,s=null,h=null;if(e.length<2)return new i(4,"",t);if(e.length>3)return new i(1,`The characters "${t.substring(3).split("").join(",")}" is exceeding the max number of characters allowed`,t);if(3===e.length){if(!a.sharp.includes(e[1])&&!a.flat.includes(e[1]))return new i(2,`The character "${e[2]}" is invalid`,t);s=e[1],r=Array.from(e[0]+e[2])}else r=e,s=null;if(!n.join("").toLowerCase().split("").includes(e[0].toLowerCase()))return new i(0,`The characer "${e[0]}" is invalid`,t);if(o=e[0].toUpperCase(),isNaN(r[1]))return new i(3,`The character "${r[1]}" is not a number`,t);if(h=Number(r[1]),null!==s){let e=null;if(e=a.sharp.includes(s)?n.indexOf(o)+1:n.indexOf(o)-1,e<0&&(e=n.length-1,h--),e>n.length-1&&(e=0,h++),h<0)return new i(7,`This result in octave being "${h}"`,t);o=n[e]}return{name:o,octave:h}}},790:t=>{"use strict";t.exports=JSON.parse('["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]')},337:t=>{"use strict";t.exports=JSON.parse('{"sharp":["#"],"flat":["b","â™­"]}')}},e={};function r(n){var a=e[n];if(void 0!==a)return a.exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{"use strict";r.r(n),r.d(n,{AudioSource:()=>h,analyser:()=>b,audioContext:()=>v,bufferLength:()=>x,dataArray:()=>S,destroyLegacyAudio:()=>A,energy:()=>f,initLegacyMicrophone:()=>M,kurtosis:()=>g,pitchDetector:()=>F,realoctave:()=>w,realpitch:()=>y,richness:()=>d,roughness:()=>m,sharpness:()=>_,warmth:()=>p});var t=r(645);class e{_inputLength;_fft;_bufferSupplier;_paddedInputBuffer;_transformBuffer;_inverseBuffer;static forFloat32Array(t){return new e(t,(t=>new Float32Array(t)))}static forFloat64Array(t){return new e(t,(t=>new Float64Array(t)))}static forNumberArray(t){return new e(t,(t=>Array(t)))}constructor(e,r){if(e<1)throw new Error("Input length must be at least one");var n;this._inputLength=e,this._fft=new t((n=2*e,n--,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,++n)),this._bufferSupplier=r,this._paddedInputBuffer=this._bufferSupplier(this._fft.size),this._transformBuffer=this._bufferSupplier(2*this._fft.size),this._inverseBuffer=this._bufferSupplier(2*this._fft.size)}get inputLength(){return this._inputLength}autocorrelate(t,e=this._bufferSupplier(t.length)){if(t.length!==this._inputLength)throw new Error(`Input must have length ${this._inputLength} but had length ${t.length}`);for(let e=0;e<t.length;e++)this._paddedInputBuffer[e]=t[e];for(let e=t.length;e<this._paddedInputBuffer.length;e++)this._paddedInputBuffer[e]=0;this._fft.realTransform(this._transformBuffer,this._paddedInputBuffer),this._fft.completeSpectrum(this._transformBuffer);const r=this._transformBuffer;for(let t=0;t<r.length;t+=2)r[t]=r[t]*r[t]+r[t+1]*r[t+1],r[t+1]=0;this._fft.inverseTransform(this._inverseBuffer,this._transformBuffer);for(let r=0;r<t.length;r++)e[r]=this._inverseBuffer[2*r];return e}}class a{_autocorrelator;_nsdfBuffer;_clarityThreshold=.9;static forFloat32Array(t){return new a(t,(t=>new Float32Array(t)))}static forFloat64Array(t){return new a(t,(t=>new Float64Array(t)))}static forNumberArray(t){return new a(t,(t=>Array(t)))}constructor(t,r){this._autocorrelator=new e(t,r),this._nsdfBuffer=r(t)}get inputLength(){return this._autocorrelator.inputLength}findPitch(t,e){this._nsdf(t);const r=function(t){const e=[];let r=!1,n=-1/0,a=-1;for(let i=1;i<t.length-1;i++)t[i-1]<=0&&t[i]>0?(r=!0,a=i,n=t[i]):t[i-1]>0&&t[i]<=0?(r=!1,-1!==a&&e.push(a)):r&&t[i]>n&&(n=t[i],a=i);return e}(this._nsdfBuffer);if(0===r.length)return[0,0];const n=Math.max(...r.map((t=>this._nsdfBuffer[t]))),a=r.find((t=>this._nsdfBuffer[t]>=this._clarityThreshold*n)),[i,o]=function(t,e){const[r,n,a]=[t-1,t,t+1],[i,o,s]=[e[r],e[n],e[a]],h=i/2-o+s/2,u=-i/2*(n+a)+o*(r+a)-s/2*(r+n),l=-u/(2*h);return[l,h*l*l+u*l+(i*n*a/2-o*r*a+s*r*n/2)]}(a,this._nsdfBuffer);return[e/i,Math.min(o,1)]}_nsdf(t){this._autocorrelator.autocorrelate(t,this._nsdfBuffer);let e,r=2*this._nsdfBuffer[0];for(e=0;e<this._nsdfBuffer.length&&r>0;e++)this._nsdfBuffer[e]=2*this._nsdfBuffer[e]/r,r-=t[e]**2+t[t.length-e-1]**2;for(;e<this._nsdfBuffer.length;e++)this._nsdfBuffer[e]=0}}var i=r(752),o=r(614),s=r.n(o);class h{constructor(t={}){this.audioContext=null,this.analyser=null,this.meydaAnalyser=null,this.pitchDetector=null,this.source=null,this.scriptProcessor=null,this._pollFrameId=null,this.isInitialized=!1,this.isExternal=!1,this._pitchConfig={clarityThreshold:t.clarityThreshold??.9,minFrequency:t.minFrequency??20,maxFrequency:t.maxFrequency??4e3},this._audioData={energy:0,roughness:0,warmth:0,richness:0,sharpness:0,kurtosis:0,pitch:null,octave:null,frequencyData:null,timeDomainData:null},this._smoothingFactor=t.smoothingFactor??.8,this._smoothedValues={energy:0,warmth:0,richness:0,sharpness:0}}async initMicrophone(){if(this.isInitialized)console.warn("AudioSource already initialized. Call destroy() first to reinitialize.");else{if(!navigator.mediaDevices?.getUserMedia)throw new Error("getUserMedia not supported in this browser");try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.smoothingTimeConstant=.8,this.analyser.fftSize=2048,this.source=this.audioContext.createMediaStreamSource(t),this.source.connect(this.analyser),this.scriptProcessor=this.audioContext.createScriptProcessor(2048,1,1),this.analyser.connect(this.scriptProcessor),this.scriptProcessor.connect(this.audioContext.destination),this.scriptProcessor.onaudioprocess=()=>{this._updateFrequencyData(),this._updatePitch()},this._initMeyda(this.source),this.isInitialized=!0,this.isExternal=!1}catch(t){throw this._cleanupPartialInit(),new Error(`Failed to initialize microphone: ${t.message}`)}}}connectExternalAnalyser(t,e){if(this.isInitialized)console.warn("AudioSource already initialized. Call destroy() first to reinitialize.");else{if(!(t&&t instanceof AnalyserNode))throw new Error("analyserNode must be an AnalyserNode instance");if(!(e&&e instanceof(window.AudioContext||window.webkitAudioContext)))throw new Error("audioContext must be an AudioContext instance");this.audioContext=e,this.analyser=t,this.isInitialized=!0,this.isExternal=!0,this.pitchDetector=a.forFloat32Array(this.analyser.fftSize),this._startPolling()}}async connectAudioElement(t){if(this.isInitialized)console.warn("AudioSource already initialized. Call destroy() first to reinitialize.");else{if(!(t&&t instanceof HTMLAudioElement))throw new Error("audioElement must be an HTMLAudioElement instance");try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.smoothingTimeConstant=.8,this.analyser.fftSize=2048,this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.analyser),this.analyser.connect(this.audioContext.destination),this._initMeyda(this.source),this._startPolling(),this.isInitialized=!0,this.isExternal=!0}catch(t){throw this._cleanupPartialInit(),new Error(`Failed to connect audio element: ${t.message}`)}}}_cleanupPartialInit(){this.scriptProcessor&&(this.scriptProcessor.onaudioprocess=null,this.scriptProcessor.disconnect(),this.scriptProcessor=null),this.source&&(this.source.disconnect(),this.source=null),this.analyser&&(this.analyser.disconnect(),this.analyser=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null)}_initMeyda(t){this.meydaAnalyser&&this.meydaAnalyser.stop(),this.meydaAnalyser=i.createMeydaAnalyzer({audioContext:this.audioContext,source:t,bufferSize:512,featureExtractors:["energy","perceptualSpread","perceptualSharpness","spectralFlatness","spectralKurtosis","spectralCentroid"],callback:t=>{t&&this._updateFeatures(t)}}),this.meydaAnalyser.start()}_startPolling(){const t=()=>{this.isInitialized?(this._updateFrequencyData(),this._updatePitch(),this.isExternal&&!this.meydaAnalyser&&this._calculateFeaturesFromFrequencyData(),this._pollFrameId=requestAnimationFrame(t)):this._pollFrameId=null};t()}_updateFrequencyData(){if(!this.analyser)return;const t=this.analyser.frequencyBinCount;this._audioData.frequencyData&&this._audioData.frequencyData.length===t||(this._audioData.frequencyData=new Uint8Array(t),this._audioData.timeDomainData=new Uint8Array(this.analyser.fftSize)),this.analyser.getByteFrequencyData(this._audioData.frequencyData),this.analyser.getByteTimeDomainData(this._audioData.timeDomainData)}_updatePitch(){if(!this.analyser||!this.audioContext)return;this.pitchDetector||(this.pitchDetector=a.forFloat32Array(this.analyser.fftSize));const t=new Float32Array(this.analyser.fftSize);this.analyser.getFloatTimeDomainData(t);try{const[e,r]=this.pitchDetector.findPitch(t,this.audioContext.sampleRate);if(r>this._pitchConfig.clarityThreshold&&e>this._pitchConfig.minFrequency&&e<this._pitchConfig.maxFrequency){const t=s().noteFromFreq(e);this._audioData.pitch=t.name,this._audioData.octave=t.octave}else this._audioData.pitch=null,this._audioData.octave=null}catch(t){this._audioData.pitch=null,this._audioData.octave=null}}_updateFeatures(t){this._smoothedValues.energy=this._smooth(this._smoothedValues.energy,t.energy||0),this._smoothedValues.warmth=this._smooth(this._smoothedValues.warmth,t.spectralCentroid||0),this._smoothedValues.richness=this._smooth(this._smoothedValues.richness,t.perceptualSpread||0),this._smoothedValues.sharpness=this._smooth(this._smoothedValues.sharpness,t.perceptualSharpness||0),this._audioData.energy=this._smoothedValues.energy,this._audioData.roughness=t.spectralFlatness||0,this._audioData.warmth=this._smoothedValues.warmth,this._audioData.richness=this._smoothedValues.richness,this._audioData.sharpness=this._smoothedValues.sharpness,this._audioData.kurtosis=t.spectralKurtosis||0}_calculateFeaturesFromFrequencyData(){if(!this._audioData.frequencyData)return;const t=this._audioData.frequencyData,e=t.length;let r=0;for(let n=0;n<e;n++)r+=t[n]*t[n];const n=Math.sqrt(r/e)/255;let a=0,i=0;for(let r=0;r<e;r++)a+=r*t[r],i+=t[r];const o=i>0?a/i*(this.audioContext.sampleRate/2/e):0;let s=0,h=0;for(let r=0;r<e;r++){const e=Math.max(t[r],1);s+=Math.log(e),h+=e}const u=Math.exp(s/e),l=h/e,c=l>0?u/l:0;this._smoothedValues.energy=this._smooth(this._smoothedValues.energy,n),this._smoothedValues.warmth=this._smooth(this._smoothedValues.warmth,Math.min(o,360)),this._audioData.energy=this._smoothedValues.energy,this._audioData.roughness=c,this._audioData.warmth=this._smoothedValues.warmth,this._audioData.richness=Math.min(2*n,1),this._audioData.sharpness=Math.min(o/1e3,1)}_smooth(t,e){return t*this._smoothingFactor+e*(1-this._smoothingFactor)}getAudioData(t=!1){return t?{...this._audioData}:this._audioData}get energy(){return this._audioData.energy}get roughness(){return this._audioData.roughness}get warmth(){return this._audioData.warmth}get richness(){return this._audioData.richness}get sharpness(){return this._audioData.sharpness}get kurtosis(){return this._audioData.kurtosis}get pitch(){return this._audioData.pitch}get octave(){return this._audioData.octave}get frequencyData(){return this._audioData.frequencyData}get timeDomainData(){return this._audioData.timeDomainData}setSmoothingFactor(t){this._smoothingFactor=Math.max(0,Math.min(1,t))}async resume(){this.audioContext&&"suspended"===this.audioContext.state&&await this.audioContext.resume()}destroy(){this._pollFrameId&&(cancelAnimationFrame(this._pollFrameId),this._pollFrameId=null),this.isInitialized=!1,this.meydaAnalyser&&(this.meydaAnalyser.stop(),this.meydaAnalyser=null),this.scriptProcessor&&(this.scriptProcessor.onaudioprocess=null,this.scriptProcessor.disconnect(),this.scriptProcessor=null),this.source&&!this.isExternal&&this.source.disconnect(),this.analyser&&!this.isExternal&&this.analyser.disconnect(),this.audioContext&&!this.isExternal&&this.audioContext.close(),this.source=null,this.analyser=null,this.audioContext=null,this.pitchDetector=null}}let u=null,l=!1,c=null,f=0,m=0,p=0,d=0,_=0,g=0,y=null,w=null,v=null,b=null,S=null,x=0;async function M(){if(l)return;u=new h,await u.initMicrophone(),v=u.audioContext,b=u.analyser;const t=()=>{if(!u||!u.isInitialized)return void(c=null);const e=u.getAudioData();f=e.energy,m=e.roughness,p=e.warmth,d=e.richness,_=e.sharpness,g=e.kurtosis,y=e.pitch,w=e.octave,S=e.frequencyData,x=S?S.length:0,c=requestAnimationFrame(t)};t(),l=!0}function A(){c&&(cancelAnimationFrame(c),c=null),u&&(u.destroy(),u=null),l=!1,f=m=p=d=_=g=0,y=w=null,v=b=null,S=null,x=0}function F(){}})(),n})()));